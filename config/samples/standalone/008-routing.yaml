apiVersion: flomesh.io/v1
kind: Proxy
metadata:
  name: pipy-008
spec:
  mode: Standalone
  tplMode: Raw
  replicas: 1
  image: flomesh/pipy:latest
  port: 8080
  config:
    config.cfg: |
      pipeline 0.0.0.0:8080
          decode-http-request
              variable_protocol = http_protocol #这个语义类似：context['http_protocol'] = parse_protocol()
              variable_path = http_path
              variable_headers = http_headers.*
          # "curl http://[ip]:[port]/[path]" request will be routed by 'path'
          # curl http://localhost:8080/hello
          # curl http://localhost:8080/test
          proxy
              to = ${http_path}
          encode-http-response
              protocol = ${http_protocol}
              variable_connection = http_headers.connection
              variable_keep_alive = http_headers.keep-alive
      pipeline /hello
          hello
              message = Hello!\n
      pipeline /test
          hello
              message = Test\n
